unit Utils.BrasilAPI;

interface

uses
  System.SysUtils, System.JSON, System.Classes, REST.Client, REST.Types;

type
  TBrasilAPI = class
  private
    function GetJSONFromURL(const AURL: string): string;
  public
    function ConsultarCEP(const ACEP: string): string;
    function ConsultarCNPJ(const ACNPJ: string): string;
    function ConsultarIBGE(const ACidade, AUF: string): string;
    function ConsultarLatLongCEP(const ACEP: string): string;
  end;

implementation

const
  BASE_URL = 'https://brasilapi.com.br/api';

{ TBrasilAPI }

function TBrasilAPI.GetJSONFromURL(const AURL: string): string;
var
  RESTClient: TRESTClient;
  RESTRequest: TRESTRequest;
  RESTResponse: TRESTResponse;
begin
  Result := '';
  RESTClient := TRESTClient.Create(AURL);
  RESTRequest := TRESTRequest.Create(nil);
  RESTResponse := TRESTResponse.Create(nil);
  try
    RESTClient.ContentType := 'application/json';
    RESTRequest.Client := RESTClient;
    RESTRequest.Response := RESTResponse;
    RESTRequest.Method := rmGET;
    RESTRequest.Execute;
    Result := RESTResponse.Content;
  finally
    RESTRequest.Free;
    RESTResponse.Free;
    RESTClient.Free;
  end;
end;

function TBrasilAPI.ConsultarCEP(const ACEP: string): string;
begin
  Result := GetJSONFromURL(BASE_URL + '/cep/v1/' + ACEP);
end;

function TBrasilAPI.ConsultarCNPJ(const ACNPJ: string): string;
begin
  Result := GetJSONFromURL(BASE_URL + '/cnpj/v1/' + ACNPJ);
end;

function TBrasilAPI.ConsultarIBGE(const ACidade, AUF: string): string;
begin
  Result := GetJSONFromURL(BASE_URL + '/ibge/municipios/v1/' + ACidade + '/' + AUF);
end;

function TBrasilAPI.ConsultarLatLongCEP(const ACEP: string): string;
begin
  Result := GetJSONFromURL(BASE_URL + '/cep/v2/' + ACEP);
end;

end.

